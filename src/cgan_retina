from pyexpat import model
from gan import CGAN
from mapper import RetinalImages
from tensorflow.keras.models import Model
from tensorflow.keras.optimizers import Adam
from tensorflow.keras.datasets import fashion_mnist
import tensorflow as tf
import numpy as np
from keras.utils.vis_utils import plot_model

train = RetinalImages.retinal_data
img_shape = (train.image_shape[0], train.image_shape[1], train.image_shape[2])

print (train.image_shape)
# D = CGAN.discriminator(inputShape=train.image_shape)
G = CGAN.generator(res=0.01,inputShape=train.image_shape)
print (G.summary())

def train_disc(model: CGAN.discriminator, data, iter=20, n_batch=32):
    for i in range(iter):
        xreal, yreal = CGAN.gen_real(data, int(n_batch/2))
        _, D_real = model.train_on_batch(xreal, yreal)
        xfake, yfake = CGAN.gen_noise(img_shape[0], img_shape[1], img_shape[2], int(n_batch/2))
        _, D_noise = model.train_on_batch(xfake, yfake)
        print('>%d real=%.0f%% fake=%.0f%%' % (i+1, D_real*100, D_noise*100))

# train_disc(D, train)

